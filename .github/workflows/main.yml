name: Daily Update

on:
  schedule:
    - cron: '5 19 * * *'  # æ¯å¤©æ—©ä¸ŠåŒ—äº¬æ—¶é—´03:05æ›´æ–°(UTCæ—¶é—´ä¸º19:05)
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ç¡®ä¿æ‹¥æœ‰å†™æƒé™ï¼Œæ‰èƒ½æ›´æ–° README
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Generate Timestamp and Update README
        run: |
          # èŽ·å–å½“å‰æ—¶é—´
          UTC_TIME=$(date -u +'%Y-%m-%d %H:%M:%S')
          BJ_TIME=$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')

          # åˆ›å»ºæ—¶é—´æˆ³å†…å®¹
          TIMESTAMP_SECTION="\n## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´\n\n"
          TIMESTAMP_SECTION+="**UTC**: \`$UTC_TIME\`  \n"
          TIMESTAMP_SECTION+="**åŒ—äº¬æ—¶é—´**: \`$BJ_TIME\`  \n\n"
          TIMESTAMP_SECTION+="> âš¡ æ­¤æ—¶é—´æˆ³ç”± GitHub Actions è‡ªåŠ¨æ›´æ–°\n"

          # å¦‚æžœå·²ç»æœ‰æ—¶é—´æˆ³éƒ¨åˆ†ï¼Œåˆ™åˆ é™¤å¹¶æ›´æ–°
          if grep -q "## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´" README.md; then
            sed -i '/## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´/,/^## \|^# /{//!d}' README.md
            sed -i '/## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´/d' README.md
          fi
          
          # æ·»åŠ æ–°çš„æ—¶é—´æˆ³
          echo -e "$TIMESTAMP_SECTION" >> README.md

      - name: Auto commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto deploy by GitHub Actions"
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
          file_pattern: README.md
